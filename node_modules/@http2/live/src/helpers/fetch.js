const fetch = require('node-fetch')
const {Agent} = require('https')
const tls = require('tls')

tls.DEFAULT_ECDH_CURVE = 'P-384:P-256'

function isLoopback (url) {
  return url.match(/^https:\/\/(localhost|\[::1]|127\.0\.0\.1|0\.0\.0\.0)(:\d+)?\//i)
}

module.exports.fetch = (url, options) => {
  if (options.agent === undefined) {
    if (isLoopback(url)) {
      options.agent = new Agent({rejectUnauthorized: false})
    }
  }
  return fetch(url, options)
}
